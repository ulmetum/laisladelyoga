---
import type { GetStaticPaths } from 'astro'
import { actions } from 'astro:actions'
import { Image } from 'astro:assets'

import MainLayout from '@/layouts/MainLayout.astro'
import Container from '@/components/Container.astro'
import MenuIcons from '@/components/icons/MenuIcons.astro'
import DateArticle from '@/components/blog/DateArticle.astro'
import PaginationBlog from '@/components/blog/PaginationBlog.astro'

const { STRAPI_HOST } = import.meta.env

export const getStaticPaths = (async ({ paginate }) => {
	const { data, error } = await actions.getAllArticles()

	if (error) {
		throw new Error('Hubo un error al obtener los art√≠culos')
	}

	const articles = data?.articles.data ?? []
	return paginate(articles, { pageSize: 4, props: { articles } })
}) satisfies GetStaticPaths

const { page } = Astro.props
---

<MainLayout title="Blog page | La isla del Yoga">
	<Container className="post my-10">
		<ul class="grid-blog">
			{
				page.data.map(({ slug, title, featuredImage, excerpt, createdAt }, i) => {
					const image = featuredImage.url.startsWith('http')
						? featuredImage.url
						: `${STRAPI_HOST}${featuredImage.url}`
					return (
						<li
							data-article={i + 1}
							class="group mx-auto flex flex-col max-xl:my-8 max-xl:w-[min(100%,900px)] xl:gap-10 xl:first:flex-row xl:[&:nth-child(3)]:flex xl:[&:nth-child(3)]:flex-col-reverse"
						>
							<a
								href={`/articles/${slug}`}
								data-image={i + 1}
								class="container-image h-[30dvh] w-full xl:h-[calc(50%-1.25rem)]"
							>
								<Image
									class="block h-full w-full object-cover"
									src={image}
									alt={title}
									width={300}
									height={200}
								/>
							</a>
							<article class="mx-1 my-6 flex h-full flex-col gap-4 xl:m-0 xl:group-first:w-1/2">
								<a href={`/articles/${slug}`}>
									<h3 class="!my-0 text-center font-light text-sky-950 xl:text-3xl">{title}</h3>
								</a>
								<div class="mx-auto h-[2px] w-28 bg-zinc-400" />
								<h5
									set:html={excerpt}
									class="!m-0 flex-1 text-center text-lg font-light italic leading-6 text-gray-600"
								/>
								<div class="flex items-end justify-between text-amber-700">
									<DateArticle color="alternative" createdAt={createdAt} />
									<MenuIcons color="alternative" className="items-end" />
								</div>
							</article>
						</li>
					)
				})
			}
		</ul>

		<!-- Pagination -->
		<PaginationBlog page={page} />
	</Container>
</MainLayout>

<style define:vars={{ headerHeight: 'var(--header-height)' }}>
	.container-image {
		position: relative;
		display: block;
		&:before {
			content: '';
			position: absolute;
			inset: 0;
			box-shadow:
				0 0 0 1px #f6f2ef,
				0 0 0 2px rgba(0, 0, 0, 0.35);
		}
	}
	@media (width >= 1280px) {
		.grid-blog {
			display: grid;
			gap: 2.5rem;
			grid-template-columns: repeat(3, 1fr);
			grid-template-rows: repeat(3, 30dvh);
			grid-template-areas:
				'top top top'
				'left center right'
				'left center right';
		}

		[data-article='1'] {
			grid-area: top;
		}
		[data-article='2'] {
			grid-area: left;
		}
		[data-article='3'] {
			grid-area: center;
		}
		[data-article='4'] {
			grid-area: right;
		}

		[data-image='1'] {
			height: 100%;
			width: 50%;
		}
	}
</style>
