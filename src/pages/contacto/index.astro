---
import MainLayout from '@/layouts/MainLayout.astro'

const email = Astro.cookies.get('email')?.value ?? ''
const name = Astro.cookies.get('name')?.value ?? ''
const rememberMe = !!email

export const prerender = false
---

<MainLayout title="Contacto | La isla del Yoga">
	<!-- component -->
	<!-- Tailwind Play: https://play.tailwindcss.com/qIqvl7e7Ww  -->

	<div class="flex min-h-screen items-center justify-start bg-white">
		<div class="mx-auto w-full max-w-lg">
			<h1 class="font-medium">Ponte en contacto conmigo</h1>
			<p class="mt-3 text-[.95rem]">
				Envíame un correo electrónico a <span
					class="text-[.95rem] text-primary underline underline-offset-2"
					>hola@laisladelyoga.com</span
				> o desde este formulario que ves aquí abajo:
			</p>

			<form id="contact-form" class="mt-10">
				<!-- This is a working contact form. 
         Get your free access key from: https://web3forms.com/  -->

				<input type="hidden" name="access_key" value="YOUR_ACCESS_KEY_HERE" />
				<div class="grid gap-6 sm:grid-cols-2">
					<div class="relative z-0">
						<input
							type="text"
							name="name"
							class="peer block w-full appearance-none border-0 border-b border-gray-500 bg-transparent px-0 py-2.5 text-sm text-gray-900 focus:border-primary focus:outline-none focus:ring-0"
							placeholder=" "
						/>
						<label
							class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:text-primary"
							>Tu nombre</label
						>
					</div>
					<div class="relative z-0">
						<input
							type="text"
							name="email"
							class="peer block w-full appearance-none border-0 border-b border-gray-500 bg-transparent px-0 py-2.5 text-sm text-gray-900 focus:border-primary focus:outline-none focus:ring-0"
							placeholder=" "
						/>
						<label
							class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:text-primary"
							>Correo electrónico</label
						>
					</div>
					<div class="relative z-0 col-span-2">
						<textarea
							name="message"
							rows="5"
							class="peer block w-full appearance-none border-0 border-b border-gray-500 bg-transparent px-0 py-2.5 text-sm text-gray-900 focus:border-primary focus:outline-none focus:ring-0"
							placeholder=" "></textarea>
						<label
							class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:text-primary"
							>Tu mensaje</label
						>
					</div>
				</div>
				<button id="btn-submit" type="submit" class="btn-submit mt-5 rounded-md px-10 py-2"
					>Enviar Mensaje</button
				>
			</form>
		</div>
	</div>
</MainLayout>

<style>
	.btn-submit {
		color: var(--text);
		box-shadow: 0 0 0 1px var(--text) inset;
		transition:
			box-shadow 0.3s ease-in-out,
			color 0.3s ease-in-out;
		&:hover {
			color: var(--white);
			box-shadow: 0 0 0 100px var(--text) inset;
		}
	}
</style>

<script>
	import { actions } from 'astro:actions'
	import Swal from 'sweetalert2'

	const form = document.getElementById('contact-form') as HTMLFormElement
	const btnSubmit = document.getElementById('btn-submit') as HTMLButtonElement

	form.addEventListener('submit', async (e) => {
		e.preventDefault()
		btnSubmit.setAttribute('disabled', 'disabled')

		const formData = new FormData(form)

		if (
			formData.get('name') === '' ||
			formData.get('email') === '' ||
			formData.get('message') === ''
		) {
			document.body.setAttribute('data-lenis-prevent', 'true')
			document.documentElement.classList.add('overflow-hidden')
			Swal.fire({
				title: 'Error!',
				text: 'Por favor, rellena todos los campos',
				confirmButtonText: 'Aceptar',
				confirmButtonColor: 'var(--primary)',
				scrollbarPadding: false,
				customClass: {
					title: 'text-primary',
					confirmButton: 'rounded-xl	'
				}
			}).then(() => {
				btnSubmit.removeAttribute('disabled')
				document.body.removeAttribute('data-lenis-prevent')
				document.documentElement.classList.remove('overflow-hidden')
			})
			return
		}

		const { data, error } = await actions.sendMessage(formData)

		if (data?.json.status === 'error') {
			throw new Error('Hubo un error al enviar el mensaje')
		}
		console.log({ data })
		form.reset()
		Swal.fire({
			title: '¡Gracias!',
			text: 'Tu mensaje ha sido enviado',
			confirmButtonText: 'Aceptar',
			confirmButtonColor: 'var(--primary)',
			customClass: {
				title: 'text-primary',
				confirmButton: 'rounded-xl	'
			}
		}).then(() => {
			btnSubmit.removeAttribute('disabled')
		})
	})
</script>
