---
import 'swiper/css'

import Container from '@/components/Container.astro'
import MainLayout from '@/layouts/MainLayout.astro'
import MainHeading from '@/components/homePage/MainHeading.astro'
import AnimationIsla from '@/components/homePage/AnimationIsla.astro'
import GridServices from '@/components/homePage/GridServices.astro'
---

<MainLayout title="Home page | La isla del Yoga">
	<section class="h-[70dvh] w-full">
		<div class="swiper mySwiper">
			<div class="swiper-wrapper">
				<div class="swiper-slide">Slide 1</div>
				<div class="swiper-slide">Slide 2</div>
				<div class="swiper-slide">Slide 3</div>
			</div>
		</div>
		<!-- <div class="autoplay-progress">
			<svg width="100" height="3" xmlns="http://www.w3.org/2000/svg">
				<rect class="progress-background" fill="lightgray"></rect>
				<rect class="progress-bar" fill="blue"></rect>
			</svg>
		</div> -->

		<div class="swiper-pagination"></div>
	</section>
	<section class="flex h-[70dvh] w-full justify-center">
		<div class="relative mt-12 flex flex-col items-center justify-center gap-4 px-4">
			<MainHeading />
			<div class="relative mx-auto flex max-w-[900px] flex-col gap-4 md:flex-row-reverse md:px-8">
				<AnimationIsla />
				<div class="flex items-center md:w-[65%]">
					<p
						class="mx-auto w-[min(100%,480px)] text-[.95rem] leading-snug md:text-right md:text-sm lg:text-base"
					>
						Lorem ipsum dolor sit amet consectetur adipisicing elit. Sit tenetur consequuntur enim
						aut perspiciatis quo delectus nulla doloremque ad fuga! Laudantium modi atque laboriosam
						unde delectus at commodi?
					</p>
				</div>
			</div>
		</div>
	</section>
	<section class="bg-white py-10">
		<Container>
			<div class="relative px-2 lg:flex lg:justify-between lg:gap-4">
				<div class="mb-4 max-lg:py-10 lg:mb-0 lg:w-[40%] lg:self-end">
					<h4
						class="mb-4 text-3xl tracking-[.12em] text-amber-700 max-lg:text-center lg:tracking-wider"
					>
						¿Qué puedo hacer por tí?
					</h4>
					<h2
						class="text-[12vw] font-light leading-none max-lg:text-center md:text-[10vw] lg:text-5xl xl:text-6xl"
					>
						Mi pasión por el Yoga
					</h2>
					<p class="text-md mt-6 leading-[1.5] max-lg:text-center lg:indent-12">
						Años de dedicación, trabajo y estudio de diversas prácticas de yoga se han convertido en
						un viaje de conocimiento y crecimiento continuo que ahora quiero compartir con todo el
						mundo.
					</p>
				</div>
				<GridServices />
			</div>
		</Container>
	</section>
</MainLayout>

<script>
	import Swiper from 'swiper'
	import { Pagination, Autoplay } from 'swiper/modules'
	// const autoplayProgress = document.querySelector('.autoplay-progress') as HTMLDivElement
	// const progressBar = document.querySelector('.autoplay-progress .progress-bar') as SVGRectElement
	// const progressContent = document.querySelector('.autoplay-progress span') as HTMLSpanElement

	const swiper = new Swiper('.swiper', {
		centeredSlides: true,
		loop: true,
		autoplay: {
			pauseOnMouseEnter: true,
			delay: 5000,
			disableOnInteraction: false,
			reverseDirection: true
		},
		pagination: {
			el: '.swiper-pagination',
			type: 'custom',
			renderCustom: function (swiper, current, total) {
				// Crea un contenedor para los elementos
				return `
            <div class="flex items-center gap-2 justify-center">
							<span class="font-heading swiper-pagination-current">${current}</span>
							<div class="autoplay-progress">
									<svg width="100" height="2" xmlns="http://www.w3.org/2000/svg">
											<rect width="100" height="2" class="progress-background" fill="lightgray"></rect>
											<rect width="100" height="2" class="progress-bar" fill="var(--amber-700)" width="0"></rect>
									</svg>
							</div>
							<span class="font-heading swiper-pagination-total">${total}</span>
						</div>
        `
			}
		},
		on: {
			autoplayTimeLeft(s, time, progress) {
				const roundedProgress = Math.round((1 - progress) * 100) // Redondea el progreso al valor más cercano.
				const progressBar = document.querySelector(
					'.autoplay-progress .progress-bar'
				) as SVGRectElement
				progressBar.setAttribute('width', `${roundedProgress}`)
				// console.log('Progress width:', roundedProgress)
				// progressContent.textContent = `${Math.ceil(time / 1000)}s`
			}
		},
		modules: [Pagination, Autoplay]
	})
</script>

<style>
	.swiper {
		width: 100%;
		height: 300px;
	}

	.swiper-slide {
		text-align: center;
		font-size: 18px;
		background: #fff;
		display: flex;
		justify-content: center;
		align-items: center;
	}

	.swiper-slide img {
		display: block;
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.swiper-pagination span {
		position: relative;
		color: var(--zinc-900);
	}

	.autoplay-progress {
		position: absolute;
		right: 16px;
		bottom: 16px;
		z-index: 10;
		width: 100px;
		height: 3px; /* Suficiente altura para ver la barra */
		display: flex;
		align-items: center;
		justify-content: center;
		font-weight: bold;
		color: var(--swiper-theme-color);
	}

	.autoplay-progress svg {
		width: 100%; /* Asegura que el SVG ocupe todo el contenedor */
		height: 100%; /* Asegura que tenga suficiente altura */
	}

	.progress-background {
		width: 100%;
		height: 100%;
		fill: lightgray; /* Color de fondo de la barra */
	}

	.progress-bar {
		height: 100%;
		fill: var(--amber-700); /* Color de la barra de progreso */
		/* transition: width 0.3s ease-out;  */
	}
</style>
